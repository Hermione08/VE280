<!DOCTYPE html>
<html>
<head>
    <title>SJTU Single Sign On</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0"/>
    <base href="/jaccount/"/>
    <link rel="icon" type="image/x-icon" href="image/favicon.png?v=20161228" />
    <link href="css/login.css?v=20161228" rel="stylesheet"/>
    <script>
        function setLocale(value) {
            var href = window.location.href;
            var regex = new RegExp("[&\\?]locale=");
            if(regex.test(href)) {
                regex = new RegExp("([&\\?])locale=\\w+");
                window.location.href = href.replace(regex, "$1locale=" + value);
            } else {
                if(href.indexOf("?") > -1)
                    window.location.href = href + "&locale=" + value;
                else
                    window.location.href = href + "?locale=" + value;
            }
        }
    </script>
    </head>
<body>
<div id="page">
    <div id="header" class="clearfix">
        <div class="container">
            <div class="logo">
                <img src="image/sjtu.png?v=20161228" border="0"/>
            </div>
            <div class="i18n action-control">
                <a href="javascript:setLocale('zh')">中文</a> | <a href="javascript:setLocale('en')">EN</a>
            </div>
        </div>
    </div>
    <div id="content">
        <div class="container">
            <div class="login-bg"></div>
            <div class="login-layout">
                


<script>

    var addEvent = function (html_element, event_name, event_function) {
        if (html_element.addEventListener) { // Modern
            html_element.addEventListener(event_name, event_function, false);
        } else if (html_element.attachEvent) { // Internet Explorer
            html_element.attachEvent("on" + event_name, event_function);
        } else { // others
            html_element["on" + event_name] = event_function;
        }
    };

    var loadScript = function (url, done, fail) {
        var head = document.getElementsByTagName("head")[0];
        var script = document.createElement("script");
        script.src = url;

        // Attach handlers for all browsers
        script.onload = script.onreadystatechange = function () {
            if (!this.readyState || this.readyState == "loaded" || this.readyState == "complete") {
                if (done != null && (typeof done == "function")) {
                    done();
                }
                // Handle memory leak in IE
                script.onload = script.onreadystatechange = null;
            }
        };

        script.onerror = function () {
            if (fail != null && (typeof fail == "function")) {
                fail();
            }
            // Handle memory leak in IE
            script.onload = script.onreadystatechange = null;
        };
        head.appendChild(script);
    };

    var hasSub = false;

    var showQr = function () {
        var qrDiv = document.getElementById('login-qr');
        if (qrDiv != null) {
            qrDiv.setAttribute('class', 'show');
        }
    };

    var showQrImg = function () {
        var qrDiv = document.getElementById('qr-img');
        if (qrDiv != null) {
            qrDiv.setAttribute('class', 'code show');
        }
    };

    var showQrMsg = function (msg) {
        var msgSpan = document.getElementById('qr-msg');
        if (msgSpan != null) {
            msgSpan.innerHTML = msg;
        }
    };

    var hideQr = function () {
        var qrDiv = document.getElementById('login-qr');
        if (qrDiv != null) {
            qrDiv.removeAttribute('class');
        }
        var form = document.getElementById('form-input');
        if (form != null) {
            form.removeAttribute('class');
        }
        var actionDiv = document.getElementById('login-action');
        if (actionDiv != null) {
            actionDiv.setAttribute('class', 'action-control');
        }
    };

    var sub = function () {
        showQr();
        if (!hasSub) {
            hasSub = true;
            showQrMsg('Loading QR code');
            loadScript("https://mc.sjtu.edu.cn/httpsClient.js", function () {
                if (window['msgCenter'] != null) {
                    var subObj = msgCenter.create('33390e21-a03a-4461-bd02-44c98513e7cd');
                    subObj.sub("100", "", function () {
                        window.location.href = "weixinlogin?uuid=33390e21-a03a-4461-bd02-44c98513e7cd";
                        return false;
                    }, function () {
                        showQrImg();
                        showQrMsg('Scan QR code with your WeChat');
                    });
                }
            }, function () {
                showQrMsg('Load QR code failed');
            });
        }
    };

    var switchLogin = function (switchDiv) {
        var div = document.getElementById('login-qr');
        if (div != null) {
            if (switchDiv.getAttribute('class') === 'login-switch') {
                switchDiv.setAttribute('class', 'login-switch pc');
                if (window.localStorage) {
                    window.localStorage.setItem("jaccount.login.type", "qrcode");
                }
                sub();
            } else {
                switchDiv.setAttribute('class', 'login-switch');
                div.removeAttribute('class');
                hideQr();
                if (window.localStorage) {
                    window.localStorage.setItem("jaccount.login.type", "password");
                }
            }
        }
    };

    var submitted = false;

    var checkForm = function (button) {

        if (submitted === true) {
            return false;
        }

        var warnUl = document.getElementById("ul_warn"),
            warnDiv = document.getElementById("div_warn"),
            user = document.getElementById("user"),
            password = document.getElementById("pass"),
            captcha = document.getElementById("captcha");

        if (warnDiv != null) {
            warnDiv.setAttribute("style", "display:none");
        }

        if (user.value == '') {
            document.getElementById("li_tip_no_user").setAttribute("style", "display:block");
            document.getElementById("li_tip_no_password").setAttribute("style", "display:none");
            document.getElementById("li_tip_no_captcha").setAttribute("style", "display:none");
            warnUl.setAttribute("style", "display:block");
            user.focus();
            return false;
        }

        if (password.value == '') {
            document.getElementById("li_tip_no_user").setAttribute("style", "display:none");
            document.getElementById("li_tip_no_password").setAttribute("style", "display:block");
            document.getElementById("li_tip_no_captcha").setAttribute("style", "display:none");
            warnUl.setAttribute("style", "display:block");
            password.focus();
            return false;
        }

        if (captcha.value == '') {
            document.getElementById("li_tip_no_user").setAttribute("style", "display:none");
            document.getElementById("li_tip_no_password").setAttribute("style", "display:none");
            document.getElementById("li_tip_no_captcha").setAttribute("style", "display:block");
            warnUl.setAttribute("style", "display:block");
            captcha.focus();
            return false;
        }

        submitted = true;
        warnUl.setAttribute("style", "display:none");
        button.setAttribute("class", button.getAttribute("class") + " submitted btn-secondary");
        return true;
    }
</script>
<div id="login-form">
    <div class="login-header">
        <div class="login-title">Login jAccount</div>
        <div id="login-switch" class="login-switch" onclick="switchLogin(this);"></div>
    </div>
    <ul id="ul_warn" class='warn-info' style="display: none">
        <li id="li_tip_no_user"><span class='icon i-warn'></span>Missing your account</li>
        <li id="li_tip_no_password"><span class='icon i-warn'></span>Missing your password</li>
        <li id="li_tip_no_captcha"><span class='icon i-warn'></span>Missing captcha</li>
    </ul>
    
    
    <form id="form-input" method="post" action="ulogin">
        <input type="hidden" name="sid" value="jasakai20130304">
        <input type="hidden" name="returl" value="CDhC/7hiHd1M/316K7wbTc7H9QAm+lQnNoH19DM9frGJwnM4sxngj7lh91h6iAXChLH5ILb6XwjO7DXZ0St5rcq6p/bA8o0/6g==">
        <input type="hidden" name="se" value="CCsHiMK+XM/Z75jalaGmRQVWEZRAz6M5ER12N/LCu9LewTw8DUhkTiLjx4JAhbKh+g==">
        <input type="hidden" name="v" value="20110607">

        <div class="input-control">
            <span class="icon i-account"></span>
            <input class="form-input" type="text" id="user" name="user"
                   placeholder="Account" autocomplete="off">
        </div>
        <div class="input-control">
            <span class="icon i-pass"></span>
            <input class="form-input" type="password" id="pass" name="pass"
                   placeholder="Password" autocomplete="off">
        </div>
        <div class="input-control captcha-input">
            <span class="icon i-captcha"></span>
            <input class="form-input" type="text" id="captcha" name="captcha"
                   placeholder="Captcha" autocomplete="off">
            <img src="captcha?1495996348098" alt=""
                 onclick="this.src='captcha?'+Date.now()+Math.random()">
        </div>
        <div>
            <input type="submit" class="btn btn-primary form-submit"
                   value="SIGN IN"
                   onclick="return checkForm(this)">
            
        </div>
    </form>
    
        <div id="login-action" class="action-control">
            <a href="https://jaccount.sjtu.edu.cn/profile/pass.do">Reset Password</a>
            <a href="https://jaccount.sjtu.edu.cn/profile/apply!registerOption.do" class="pull-right">Sign Up</a>
        </div>
    
    <div id="login-qr">
        <div id="qr-img" class="code">
            <img src="qrcode?uuid=33390e21-a03a-4461-bd02-44c98513e7cd" border="0"/>
        </div>
        <div class="qr-tips">
            --&nbsp;<span id="qr-msg"></span>&nbsp;--
        </div>
    </div>
</div>

<script>

    if (window.localStorage) {
        var type = window.localStorage.getItem("jaccount.login.type");
        if (type == 'qrcode') {
            var switchDiv = document.getElementById('login-switch');
            if (switchDiv != null) {
                switchDiv.setAttribute('class', 'login-switch pc');
            }
            var form = document.getElementById('form-input');
            if (form != null) {
                form.setAttribute('class', 'hide');
            }
            var actionDiv = document.getElementById('login-action');
            if (actionDiv != null) {
                actionDiv.setAttribute('class', 'action-control hide');
            }
            if (window.getComputedStyle !== undefined) {
                if (window.getComputedStyle(form).visibility == 'hidden') {
                    sub();
                }
            } else {
                //ie8
                if (form.currentStyle !== undefined) {
                    if (form.currentStyle.visibility == 'hidden') {
                        sub();
                    }
                }
            }

        }
    }

    addEvent(window, "orientationchange", function () {
        setTimeout(function(){
            var form = document.getElementById('form-input');
            if (window.getComputedStyle !== undefined) {
                if (window.getComputedStyle(form).visibility == 'hidden') {
                    sub();
                }
            }
        },100);
    });

</script></div>
        </div>
    </div>
    <div id="footer">
        <div class="container">
            <div class="contact">
                Xuhui campus: 4/F Hao Ran Hi-Tech Building 62932901 Minhang campus: 1/F Library & Information Building 34206060<br>
                <span class="en">©2016</span> <a href="http://net.sjtu.edu.cn">SJTU Network & Information Center</a> <a href="mailto:service@sjtu.edu.cn">service@sjtu.edu.cn</a>
                    </div>
            <a class="net" href="http://net.sjtu.edu.cn"><img src="image/ja-net.png" border="0"></a>
        </div>
    </div>
</div>
</body>
</html>